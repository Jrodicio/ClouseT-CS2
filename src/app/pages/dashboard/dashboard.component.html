<button (click)="logout()">Logoff</button>
<div style="padding:16px;font-family:system-ui;">
  @if (auth.user$ | async; as user) {
    @if (steamIdFromUid(user.uid); as mySteamId) {
      <div
        style="
          display:grid;
          grid-template-columns: 1fr 1.2fr 1fr;
          gap:16px;
          align-items:start;
        "
      >
        <!-- ================= LEFT: Mi Steam ================= -->
        <section style="border:1px solid #e5e5e5;border-radius:12px;padding:12px;">
          <div style="display:flex;gap:12px;align-items:center;">
            @if (profileOf(mySteamId); as me) {
              <img
                [src]="me.avatar"
                width="56"
                height="56"
                style="border-radius:12px;object-fit:cover;"
                alt="avatar"
              />
              <div style="min-width:0;">
                <div style="font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                  {{ me.personaName }}
                </div>
                <div style="font-size:12px;opacity:.7;">{{ me.steamId }}</div>
                <a [href]="me.profileUrl" target="_blank" rel="noreferrer" style="font-size:12px;">
                  Ver perfil
                </a>
              </div>
            } @else {
              <div style="font-size:13px;opacity:.8;">Cargando perfil Steam…</div>
            }
          </div>

          <div style="margin-top:12px;border-top:1px solid #eee;padding-top:12px;">
            @if (match$ | async; as match) {
              @switch (myStatus(match, mySteamId)) {
                @case ('cola') {
                  <div style="font-size:13px;">
                    Estado: <b>En cola</b>
                  </div>
                }
                @case ('team1') {
                  <div style="font-size:13px;">
                    Estado: <b>En match (Team A)</b>
                  </div>
                }
                @case ('team2') {
                  <div style="font-size:13px;">
                    Estado: <b>En match (Team B)</b>
                  </div>
                }
                @default {
                  <div style="font-size:13px;">
                    Estado: <b>Fuera</b>
                  </div>
                }
              }
            } @else {
              <div style="font-size:13px;opacity:.8;">Cargando match…</div>
            }
          </div>

          <div style="margin-top:12px;">
            <button (click)="logout()" style="padding:10px 14px;cursor:pointer;width:100%;">
              Logout
            </button>
          </div>
        </section>

        <!-- ================= CENTER: Acciones ================= -->
        <section style="border:1px solid #e5e5e5;border-radius:12px;padding:12px;">
          <h3 style="margin:0 0 8px 0;">Acciones</h3>

          @if (match$ | async; as match) {
            @switch (match.estado) {
              @case ('esperando_jugadores') {
                <div style="font-size:13px;opacity:.8;margin-bottom:10px;">
                  Esperando jugadores ({{ match.queue.length }}/10)
                </div>

                @if (myStatus(match, mySteamId) === 'cola') {
                  <button
                    (click)="leave(match, mySteamId)"
                    style="padding:10px 14px;cursor:pointer;width:100%;"
                  >
                    Salir del match
                  </button>
                } @else {
                  <button
                    (click)="join(match, mySteamId)"
                    style="padding:10px 14px;cursor:pointer;width:100%;"
                  >
                    Ingresar al match
                  </button>
                }
              }

              @case ('seleccionando_lideres') {
                <div style="font-size:13px;opacity:.8;margin-bottom:10px;">
                  Seleccionando líderes…
                </div>

                @if (myStatus(match, mySteamId) === 'fuera') {
                  <button
                    (click)="toggleWatch()"
                    style="padding:10px 14px;cursor:pointer;width:100%;"
                  >
                    {{ watchMatch ? 'Dejar de ver' : 'Ver match' }}
                  </button>

                  @if (!watchMatch) {
                    <div style="margin-top:10px;font-size:13px;opacity:.7;">
                      Activá “Ver match” para ver el detalle del estado.
                    </div>
                  }
                } @else {
                  <div style="font-size:13px;opacity:.7;">
                    Estás dentro. Vas a ver el estado completo a la derecha.
                  </div>
                }
              }

              @case ('armando_equipos') {
                <div style="font-size:13px;opacity:.8;margin-bottom:10px;">
                  Armando equipos…
                </div>

                @if (myStatus(match, mySteamId) === 'fuera') {
                  <button
                    (click)="toggleWatch()"
                    style="padding:10px 14px;cursor:pointer;width:100%;"
                  >
                    {{ watchMatch ? 'Dejar de ver' : 'Ver match' }}
                  </button>
                } @else {
                  <div style="font-size:13px;opacity:.7;">
                    Seleccioná jugadores en el panel de la derecha.
                  </div>
                }
              }

              @case ('seleccionando_mapa') {
                <div style="font-size:13px;opacity:.8;margin-bottom:10px;">
                  Baneando mapas…
                </div>

                @if (myStatus(match, mySteamId) === 'fuera') {
                  <button
                    (click)="toggleWatch()"
                    style="padding:10px 14px;cursor:pointer;width:100%;"
                  >
                    {{ watchMatch ? 'Dejar de ver' : 'Ver match' }}
                  </button>
                } @else {
                  <div style="font-size:13px;opacity:.7;">
                    Baneá mapas en el panel de la derecha.
                  </div>
                }
              }

              @case ('en_curso') {
                <div style="font-size:13px;opacity:.8;margin-bottom:10px;">
                  Match en curso
                </div>

                <div style="font-size:13px;margin-bottom:10px;">
                  Mapa: <b>{{ match.map ?? '—' }}</b>
                </div>

                @if (activeServerConnection; as connection) {
                  @if (myStatus(match, mySteamId) === 'fuera') {
                    <a
                      [href]="connection.spectateUrl"
                      style="padding:10px 14px;cursor:pointer;width:100%;display:inline-block;text-align:center;text-decoration:none;border:1px solid #ccc;border-radius:6px;"
                    >
                      Ingresar como espectador
                    </a>
                  } @else {
                    <a
                      [href]="connection.connectUrl"
                      style="padding:10px 14px;cursor:pointer;width:100%;display:inline-block;text-align:center;text-decoration:none;border:1px solid #ccc;border-radius:6px;"
                    >
                      Ingresar al servidor
                    </a>
                  }
                }
                @if (serverConnectionError) {
                  <div style="font-size:12px;opacity:.7;margin-top:8px;">
                    {{ serverConnectionError }}
                  </div>
                }
              }
            }
          } @else {
            <div style="font-size:13px;opacity:.8;">Cargando match…</div>
          }
        </section>

        <!-- ================= RIGHT: Estado Match ================= -->
        @if (match$ | async; as match) {
          <app-match-board
            [match]="match"
            [showDetails]="myStatus(match, mySteamId) !== 'fuera' || watchMatch"
            [profileOf]="profileOf.bind(this)"
            [leaderA]="match.team1?.players?.[0] ?? null"
            [leaderB]="match.team2?.players?.[0] ?? null"
            [mySteamId]="mySteamId"
            [connection]="activeServerConnection"
          />


        }        
      </div>
    } @else {
      <div>UID inválido (no es steam:...)</div>
    }
  } @else {
    <p>Cargando sesión…</p>
  }
</div>
